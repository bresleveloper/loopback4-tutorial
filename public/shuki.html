<!DOCTYPE html>
<html lang="en">

<head>
  <title>tryung to get it</title>

<body>
  <div class="info">
    <h1>shuki show all</h1>
    <h2>here Read|Get, Delete|Delete</h2>
    <h4>Read|Get for single item in the form</h4>
    <h2>click and item for Create|Post, Update|Put</h2>
  </div>

  <div>
    <table border="1">
      <thead>
        <tr>
          <th>id</th>
          <th>name</th>
          <th>age</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <dialog>
    <p>name</p>
  </dialog>

  <script>

    function getAllUsers() {
      var x = new XMLHttpRequest();
      x.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          //document.getElementById("demo").innerHTML = this.responseText;
          //[{"id":1,"name":"shuky","age":20}
          let arr = JSON.parse(this.responseText)
          let t = document.querySelector('table tbody')
          arr.forEach(u => {
            t.innerHTML += '<tr>' +
              '<td>' + u.id + '</td>' +
              '<td>' + u.name + '</td>' +
              '<td>' + u.age + '</td>' +
              '</tr>';
          });

          setDialogAndClicks()
        }
      };
      x.open("GET", "http://localhost:3000/shuki-personal");
      x.send();
    }

    getAllUsers();


    setDialogAndClicks = () => {
      let rows = document.querySelectorAll('table tbody tr')
      rows.forEach(r => {
        r.onclick = ev => {
          getPersonalDataForDialog(r)
        }
      })
    }

    getPersonalDataForDialog = r => {
      let id = r.querySelector('td').textContent


      //window.open('/shuki form.html?id=' + id)
      location.href = '/shuki form.html?id=' + id



      var x = new XMLHttpRequest();
      x.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          let data = JSON.parse(this.responseText)
          let p = document.querySelector('dialog p')
          p.innerHTML = data.name

          let d = document.querySelector('dialog')
          d.showModal()
          setTimeout(() => {
            d.close()
          }, 3000)
        }
      };
      x.open("GET", "http://localhost:3000/shuki-personal/" + id);
      x.send();
    }


  </script>

</body>

</html>
